# Chatbot Integration

It is easy and simple to imbue your chatbot with the NLP power that Haystack offers.
If your chatbot is handling a question that is in the log tail of undefined intents, why not handle it using Haystack's question answering capabilities?
Thanks to Haystack's REST API, chatbot frameworks can seamlessly communicate with your custom Haystack service.
Below, we will trace through what it takes to set this up using the popular [Rasa](https://rasa.com/) framework.

<div className="max-w-xl bg-yellow-light-theme border-l-8 border-yellow-dark-theme px-6 pt-6 pb-4 my-4 rounded-md dark:bg-yellow-900">

**Demo:** For a bare bones example of a Rasa chatbot communicating with Haystack, have a look at [this repo](https://github.com/deepset-ai/rasa-haystack).

</div>

## Overview

When a user speaks to a conversational AI program, each user message is classified and labelled with an intent.
One approach to integrating Haystack would be to introduce a new intent, such as `knowledge question`, 
that triggers a call to a running Haystack API.

Alternatively, in cases where they are uncertain what intent fits, chatbots can route requests to a fallback action. 
Rasa uses the [FallbackClassifier](https://rasa.com/docs/rasa/fallback-handoff/#nlu-fallback) to make this happen.

In both cases, Rasa uses an [action server](https://rasa.com/docs/action-server/) to send a REST API request to Haystack.
When it receives the result, it will base its next message to the user on the contents of this response. 

!!!NEW IMAGE!!!
![image](https://user-images.githubusercontent.com/52320144/111071900-930f7c00-84d8-11eb-9105-b06ee4a4735b.png)

## Starting Haystack with REST API

To set up a Haystack instance with REST API, have a look at [this documentation page](/usage/rest-api).
By default, the API server runs on `http://127.0.0.1:8000`.

<div className="max-w-xl bg-yellow-light-theme border-l-8 border-yellow-dark-theme px-6 pt-6 pb-4 my-4 rounded-md dark:bg-yellow-900">

**Quick-start demo:** Bundled with the Github repository is an example Haystack service with REST API that queries the Game of Thrones Wiki.
Simply clone it and call the following in the root directory:

``` bash
    cd haystack
    docker-compose pull
    docker-compose up
    
    # Or on a GPU machine: docker-compose -f docker-compose-gpu.yml up
```
</div>

## Starting Rasa

After [installing](https://rasa.com/docs/rasa/installation) Rasa and [initializing](https://rasa.com/docs/rasa/command-line-interface/#rasa-init) a new project, 
there are a few steps that a developer needs to take in order to get Rasa to communicate with Haystack.

In `data/nlu.yaml`, you will want to define a new intent but providing example utterances of that intent:
```
nlu:
- intent: knowledge_question
  examples: |
    - Can you look this up: what is ?
    - Look this up: what is?
    - Can you check: what is?
    - please check: What is ?
    - Can you look this up: where is ?
    - Look this up: where is?
    - Can you check: where is?
    - please check: where is ?
````

You will also want to define what action is taken when that intent is identified in the `rules.yml` file:
```
- rule: Query Haystack anytime the user has a direct question for your document base
  steps:
  - intent: knowledge_question
  - action: call_haystack
``` 

Fallback version



Files changed from Rasa init
actions
rule
endpoints?
nlu

Defining Fallback / Custom Action

See our demo Repo

Rasa X vs Rasa Core + Screen shot

Rasa run actions for action server


   - name: FallbackClassifier
     # This is the default
     threshold: 0.8
     ambiguity_threshold: 0.1
train
model that is pushed



retrain